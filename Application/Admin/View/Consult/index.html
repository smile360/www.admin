<include file="Public/min-header"/>
<div class="wrapper">
    <include file="Public/breadcrumb"/>
	<section class="content">
       <div class="row">
       		<div class="col-xs-12">
	       		<div class="box">
	           	<div class="box-header">
	                <nav class="navbar navbar-default">	     
				        <div class="collapse navbar-collapse">
				          <form class="navbar-form form-inline" action="{:U('Consult/index')}" method="post">
				            <div class="form-group">
				              	<input type="text" name="keywords" class="form-control" style="width:200px" placeholder="请输入咨询标题或用户名" value="{$keywords}">
				            </div>
				           	
				            <button id="button-filter search-order"type="submit" class="btn btn-primary"><i class="fa fa-search"></i>筛选</button>
				            <!-- <div class="form-group pull-right">
					            <a href="{:U('Consult/index')}" class="btn btn-primary pull-right"><i class="fa fa-plus"></i>添加新课程</a>
				            </div>	 -->	          
				          </form>		
				      	</div>
	    			</nav>               
	             </div>	    
	             <!-- /.box-header -->
	             <div class="box-body">	             
	           		<div class="row">
	            	<div class="col-sm-12">
		              <table id="list-table" class="table table-bordered table-striped dataTable" role="grid" aria-describedby="example1_info">
		                 <thead>
		                   <tr role="row" >
			                   <th class="sorting_asc" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending" style="width: 154px;">咨询ID</th>
			                   <th class="sorting" style="width: 100px;" tabindex="0" aria-controls="example1"  aria-label="Platform(s): activate to sort column ascending">咨询用户</th>
			                   <!-- <th class="sorting" tabindex="0" aria-controls="example1"  aria-label="Browser: activate to sort column ascending">活动内容</th>
			                   <th class="sorting" tabindex="0" aria-controls="example1"  aria-label="Platform(s): activate to sort column ascending">活动描述</th> -->
			                   <th class="sorting" style="width: 200px;" tabindex="0" aria-controls="example1"  aria-label="Platform(s): activate to sort column ascending">咨询标题</th>
			                   <th class="sorting" style="width: 300px;" tabindex="0" aria-controls="example1"  aria-label="Platform(s): activate to sort column ascending">咨询内容</th>
			                   <th class="sorting" style="width: 300px;" tabindex="0" aria-controls="example1"  aria-label="Platform(s): activate to sort column ascending">咨询图片</th>
			                   <!-- <th class="sorting" style="width: 150px;" tabindex="0" aria-controls="example1"  aria-label="Platform(s): activate to sort column ascending">课程地址</th> -->
			                   <th class="sorting" style="width: 100px;" tabindex="0" aria-controls="example1"  aria-label="Platform(s): activate to sort column ascending">提交时间</th>
			                   <th class="sorting" style="width: 100px;" tabindex="0" aria-controls="example1"  aria-label="Platform(s): activate to sort column ascending">状态</th>
			                   
			                   <!-- <th class="sorting" tabindex="0" aria-controls="example1"  aria-label="Platform(s): activate to sort column ascending">显示</th> -->
			                   <!-- <th class="sorting" style="width: 60px;" tabindex="0" aria-controls="example1"  aria-label="Engine version: activate to sort column ascending">发布时间</th> -->
			                   <!-- <th class="sorting" tabindex="0" aria-controls="example1"  aria-label="Engine version: activate to sort column ascending">排序</th> -->
			                   <th class="sorting" tabindex="0" aria-controls="example1"  aria-label="Engine version: activate to sort column ascending">点赞人数</th>
			                   <th class="sorting" tabindex="0" aria-controls="example1"  aria-label="CSS grade: activate to sort column ascending">操作</th>
		                   </tr>
		                 </thead>
						<tbody>
						  <foreach name="list" item="vo" key="k" >
						  	<tr role="row" align="center">
			                    <td>{$vo.consult_id}</td>
			                    <td class="name_{$vo.consult_id}">{$vo.nickname}</td>
			                    <td>{$vo.tittle|getSubstr=0,20}</td>
			                    <td>{$vo.detail|getSubstr=0,30}</td>
			                    <td style="float:left">
			                     	<img style="width:100px;height=20px;" src="{$vo.path.0}" alt="">
			                     	<img style="width:100px;height=20px;" src="{$vo.path.1}" alt="">
			                    </td>
		                        <td>{$vo.createtime|date='Y-m-d',###}</td>
	                            <td class="status_{$vo.consult_id}">
	                            	<if condition="$vo.status eq '1' ">
										<span style="color:green;font-weight:bold"> 已解决咨询 </span>
	                            	<else />
										<span style="color:red;font-weight:bold"> 待解决咨询 </span>
	                            	</if>
	                            </td>
								<td>{$vo.like}</td>
			                    <td>
			                    	<if condition="$vo.status eq '1' ">
										<a href="javascript:void(0)"  data-id="1" class="btn btn-danger">已解决</a>
									<else />
										<a  href="javascript:void(0)" data-id="1" class="btn btn-info" onclick="check(this,{$vo.consult_id})">确认解决</a>
									</if>
			                      	<a  href="{:U('Consult/detail',array('id'=>$vo['consult_id']))}" data-toggle="tooltip" title="" class="btn btn-info" data-original-title="查看详情">查看回复
			                      	<!-- <i class="fa fa-eye"></i> -->
			                      	</a>
			                      	<a class="btn btn-danger" href="javascript:void(0)" data-url="{:U('Consult/del')}" data-id="{$vo.consult_id}" onclick="delfun(this)"><i class="fa fa-trash-o"></i></a>
	                             <!--  <a href="javascript:void(0);" onclick="ClearAritcleHtml('{$vo[article_id]}')" class="btn btn-default" title="清除静态缓存页面"><i class="fa fa-fw fa-refresh"></i></a> -->
					     		</td>
		                    </tr>
		                  </foreach>
		                   </tbody>
		                 <tfoot>
		                 
		                 </tfoot>
		               </table>
	               </div>
	          </div>
              <div class="row">
              	    <div class="col-sm-6 text-left"></div>
                    <div class="col-sm-6 text-right">{$page}</div>		
              </div>
	          </div><!-- /.box-body -->
	        </div><!-- /.box -->
       	</div>
       </div>
   </section>
</div>
<script>
// 修改指定表的排序字段
// function updateActivitySort(id_name,id_value,field,obj)
// {		     
//  		var value = $(obj).val();
// 		$.ajax({
// 				url:"{:U('Activity/changeTableSort')}?id_name="+id_name+"&id_value="+id_value+"&field="+field+'&value='+value,			
// 				success: function(data){
// 					if( data.code == 200){
// 						layer.msg('更新成功', {icon: 1});
// 					}else{
// 						$(obj).val(data);
// 						layer.msg('更新失败', {icon: 2});
// 					}								   
// 				}
// 		});		
// }
function check( obj , id){
	var name = $(".name_"+id).html();
	if(confirm("确认用户[  "+name+"  ]的问题已经解决了")){	
		$.ajax({
			type : 'post',
			url : "{:U('Consult/confirm')}",
			data : {id:id},
			dataType : 'json',
			success : function(data){
				if(data.code == 200){
					$('.status_'+id+' span').html('已解决咨询');
					$('.status_'+id+' span').css('color','green');
					$(obj).text('已解决');
					$(obj).removeClass().addClass("btn btn-danger");
					$(obj).removeAttr("onclick");
					layer.msg('已解决');
				}else{
					layer.alert('操作失败，请稍候再试', {icon: 2});  //alert('删除失败');
				}
			}
		})
	}
	return false;
}
function delfun(obj){
	if(confirm('确认删除')){		
		$.ajax({
			type : 'post',
			url : $(obj).attr('data-url'),
			data : {id:$(obj).attr('data-id')},
			dataType : 'json',
			success : function(data){
				if(data==200){
					$(obj).parent().parent().remove();
					layer.alert('删除成功',{icon:1})
				}else{
					layer.alert('删除失败', {icon: 2});  //alert('删除失败');
				}
			}
		})
	}
	return false;
}
 
    /*
     * 清除文章静态页面缓存
     */
  //   function ClearAritcleHtml(article_id)
  //   {
  //   	$.ajax({
  //                   type:'GET',
  //                   url:"{:U('Admin/System/ClearAritcleHtml')}",
  //                   data:{article_id:article_id},
  //                   dataType:'json',
  //                   success:function(data){
  //                           layer.alert(data.msg, {icon: 2});								 
  //                   }
		// });
  //   }
    
</script>
</body>
</html>